<!--
&lt;!&ndash;
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>My ToDoList</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light navbar-custom">
    <a class="navbar-brand" href="#">
        <i class="fas fa-check-double mr-2"></i>ToDoList
    </a>
    <div class="collapse navbar-collapse justify-content-end">
        <ul class="navbar-nav">
            <li class="nav-item mr-3">
                <span class="navbar-text">Welcome, <strong sec:authentication="name">User</strong>!</span>
            </li>
            <li class="nav-item">
                <form th:action="@{/logout}" method="post" class="form-inline">
                    <button type="submit" class="btn btn-outline-warning">
                        <i class="fas fa-sign-out-alt mr-1"></i>Logout
                    </button>
                </form>
            </li>
        </ul>
    </div>
</nav>

<div class="container container-main">
    <div th:if="${message}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${message}"></span>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <div class="card mb-5">
        <div class="card-header card-header-custom">
            <i class="fas fa-plus-circle mr-2"></i>Add New Task
        </div>
        <div class="card-body">
            <form th:action="@{/tasks}" th:object="${newTask}" method="post" class="form-add-task">
                <div class="form-group">
                    <label for="title" class="sr-only">Task Title</label>
                    <input type="text" id="title" th:field="*{title}" class="form-control form-control-lg"
                           placeholder="What do you need to do?"
                           th:classappend="${#fields.hasErrors('title') ? 'is-invalid' : ''}" required/>
                    <div th:if="${#fields.hasErrors('title')}" th:errors="*{title}" class="invalid-feedback"></div>
                </div>
                <div class="form-group">
                    <label for="description" class="sr-only">Description (Optional)</label>
                    <textarea id="description" th:field="*{description}" class="form-control"
                              rows="2" placeholder="Optional description..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-lg btn-block">
                    <i class="fas fa-paper-plane mr-2"></i>Add Task
                </button>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-header card-header-custom">
            <i class="fas fa-tasks mr-2"></i>Your Tasks
        </div>
        <div class="card-body p-0">
            <ul class="list-group list-group-flush">
                <li th:each="task : ${tasks}"
                    th:classappend="${task.completed ? 'completed-task' : ''}"
                    class="list-group-item task-item">
                    <div class="task-content">
                        <h5 class="task-title" th:text="${task.title}">Task Title</h5>
                        <p th:if="${task.description}" class="task-description" th:text="${task.description}"></p>
                        <small class="text-muted mt-1" th:text="${#temporals.format(task.createdAt, 'MMM dd, yyyy HH:mm')}"></small>
                    </div>
                    <div class="task-actions">
                        <form th:action="@{/tasks/{id}/toggle(id=${task.id})}" method="post" class="d-inline-block">
                            <button type="submit"
                                    th:classappend="${task.completed ? 'btn-toggle-complete incomplete' : 'btn-toggle-complete'}"
                                    class="btn btn-sm btn-icon">
                                <span th:if="${task.completed}"><i class="fas fa-times mr-1"></i>Mark Incomplete</span>
                                <span th:unless="${task.completed}"><i class="fas fa-check mr-1"></i>Mark Complete</span>
                            </button>
                        </form>
                        <form th:action="@{/tasks/{id}/delete(id=${task.id})}" method="post" class="d-inline-block">
                            <button type="submit" class="btn btn-danger btn-sm btn-icon btn-delete"
                                    onclick="return confirm('Are you sure you want to delete this task?');">
                                <i class="fas fa-trash-alt"></i> Delete
                            </button>
                        </form>
                    </div>
                </li>
                <li th:if="${#lists.isEmpty(tasks)}" class="list-group-item text-muted">
                    No tasks yet! Add one above to get started.
                </li>
            </ul>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>&ndash;&gt;



<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>My ToDoList</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light navbar-custom">
    <a class="navbar-brand" href="#">
        <i class="fas fa-check-double mr-2"></i>ToDoList
    </a>
    <div class="collapse navbar-collapse justify-content-end">
        <ul class="navbar-nav">
            <li class="nav-item mr-3">
                <span class="navbar-text">Welcome, <strong sec:authentication="name">User</strong>!</span>
            </li>
            <li class="nav-item">
                <form th:action="@{/logout}" method="post" class="form-inline">
                    <button type="submit" class="btn btn-outline-warning">
                        <i class="fas fa-sign-out-alt mr-1"></i>Logout
                    </button>
                </form>
            </li>
        </ul>
    </div>
</nav>

<div class="container container-main">
    <div th:if="${message}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${message}"></span>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <div class="card mb-5">
        <div class="card-header card-header-custom">
            <i class="fas fa-plus-circle mr-2"></i>Add New Task
        </div>
        <div class="card-body">
            <form th:action="@{/tasks}" th:object="${newTask}" method="post" class="form-add-task">
                <div class="form-group">
                    <label for="title" class="sr-only">Task Title</label>
                    <input type="text" id="title" th:field="*{title}" class="form-control form-control-lg"
                           placeholder="What do you need to do?"
                           th:classappend="${#fields.hasErrors('title') ? 'is-invalid' : ''}" required/>
                    <div th:if="${#fields.hasErrors('title')}" th:errors="*{title}" class="invalid-feedback"></div>
                </div>
                <div class="form-group">
                    <label for="description" class="sr-only">Description (Optional)</label>
                    <textarea id="description" th:field="*{description}" class="form-control"
                              rows="2" placeholder="Optional description..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-lg btn-block">
                    <i class="fas fa-paper-plane mr-2"></i>Add Task
                </button>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-header card-header-custom">
            <i class="fas fa-tasks mr-2"></i>Your Tasks
        </div>
        <div class="card-body p-0">
            <ul class="list-group list-group-flush">
                <li th:each="task : ${tasks}"
                    th:classappend="${task.completed ? 'completed-task' : ''}"
                    class="list-group-item task-item" th:data-task-id="${task.id}" th:data-task-title="${task.title}" th:data-task-description="${task.description}" th:data-task-completed="${task.completed}">
                    <div class="task-content">
                        <h5 class="task-title" th:text="${task.title}">Task Title</h5>
                        <p th:if="${task.description}" class="task-description" th:text="${task.description}"></p>
                        <small class="text-muted mt-1" th:text="${#temporals.format(task.createdAt, 'MMM dd,yyyy HH:mm')}"></small>
                    </div>
                    <div class="task-actions">
                        <form th:action="@{/tasks/{id}/toggle(id=${task.id})}" method="post" class="d-inline-block">
                            <button type="submit"
                                    th:classappend="${task.completed ? 'btn-toggle-complete incomplete' : 'btn-toggle-complete'}"
                                    class="btn btn-sm btn-icon">
                                <span th:if="${task.completed}"><i class="fas fa-times mr-1"></i>Mark Incomplete</span>
                                <span th:unless="${task.completed}"><i class="fas fa-check mr-1"></i>Mark Complete</span>
                            </button>
                        </form>
                        <button type="button" class="btn btn-info btn-sm btn-icon edit-task-btn" data-toggle="modal" data-target="#editTaskModal">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <form th:action="@{/tasks/{id}/delete(id=${task.id})}" method="post" class="d-inline-block">
                            <button type="submit" class="btn btn-danger btn-sm btn-icon btn-delete"
                                    onclick="return confirm('Are you sure you want to delete this task?');">
                                <i class="fas fa-trash-alt"></i> Delete
                            </button>
                        </form>
                    </div>
                </li>
                <li th:if="${#lists.isEmpty(tasks)}" class="list-group-item text-muted">
                    No tasks yet! Add one above to get started.
                </li>
            </ul>
        </div>
    </div>

    <div class="card mt-5">
        <div class="card-header card-header-custom">
            <i class="fas fa-robot mr-2"></i>AI Prioritization Suggestion
        </div>
        <div class="card-body text-center">
            <button id="getAiSuggestionBtn" class="btn btn-info btn-lg">
                <i class="fas fa-brain mr-2"></i>Get AI Task Suggestion
            </button>
            <div id="aiSuggestionOutput" class="alert alert-light mt-3" role="alert" style="display: none;">
            </div>
            <div id="aiLoadingSpinner" class="spinner-border text-info mt-3" role="status" style="display: none;">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
    </div>

</div>

<div class="modal fade" id="editTaskModal" tabindex="-1" role="dialog" aria-labelledby="editTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editTaskModalLabel"><i class="fas fa-edit mr-2"></i>Edit Task</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="editTaskForm">
                    <input type="hidden" id="editTaskId">
                    <div class="form-group">
                        <label for="editTaskTitle">Title:</label>
                        <input type="text" class="form-control" id="editTaskTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="editTaskDescription">Description:</label>
                        <textarea class="form-control" id="editTaskDescription" rows="3"></textarea>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="editTaskCompleted">
                        <label class="form-check-label" for="editTaskCompleted">Completed</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveTaskChangesBtn"><i class="fas fa-save mr-2"></i>Save changes</button>
            </div>
        </div>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script th:inline="javascript">
    /*<![CDATA[*/

    // AI Suggestion Logic (from previous step)
    document.getElementById('getAiSuggestionBtn').addEventListener('click', function() {
        const outputDiv = document.getElementById('aiSuggestionOutput');
        const spinner = document.getElementById('aiLoadingSpinner');
        const button = this;

        // Hide previous suggestion, show spinner, disable button
        outputDiv.style.display = 'none';
        outputDiv.innerHTML = '';
        spinner.style.display = 'block';
        button.disabled = true;

        fetch('/api/tasks/prioritize-suggestion', {
            method: 'GET',
            headers: {
                'Accept': 'text/plain',
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => { throw new Error(text) });
                }
                return response.text();
            })
            .then(data => {
                outputDiv.innerHTML = '<pre>' + data + '</pre>';
                outputDiv.classList.remove('alert-danger');
                outputDiv.classList.add('alert-light');
                outputDiv.style.display = 'block';
            })
            .catch(error => {
                console.error('Error fetching AI suggestion:', error);
                //outputDiv.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>Failed to get suggestion: ' + error.message;
                outputDiv.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>Please purchase Chatgpt Premium to get suggestion ' + error.message;
                outputDiv.classList.remove('alert-light');
                outputDiv.classList.add('alert-danger');
                outputDiv.style.display = 'block';
            })
            .finally(() => {
                spinner.style.display = 'none';
                button.disabled = false;
            });
    });

    // EDIT MODAL LOGIC
    $(document).ready(function() { // Ensure jQuery is loaded and DOM is ready

        // When an "Edit" button is clicked
        $('.edit-task-btn').on('click', function() {
            // Get data attributes from the <li> element (parent of the button)
            const $taskItem = $(this).closest('li');
            const taskId = $taskItem.data('taskId');
            const taskTitle = $taskItem.data('taskTitle');
            const taskDescription = $taskItem.data('taskDescription');
            const taskCompleted = $taskItem.data('taskCompleted'); // Boolean value

            // Populate the modal form fields
            $('#editTaskId').val(taskId);
            $('#editTaskTitle').val(taskTitle);
            $('#editTaskDescription').val(taskDescription);
            $('#editTaskCompleted').prop('checked', taskCompleted); // Set checkbox state
        });

        // When the "Save changes" button in the modal is clicked
        $('#saveTaskChangesBtn').on('click', function() {
            const taskId = $('#editTaskId').val();
            const updatedTask = {
                title: $('#editTaskTitle').val(),
                description: $('#editTaskDescription').val(),
                completed: $('#editTaskCompleted').is(':checked')
            };

            // Send PUT request to the backend
            $.ajax({
                url: '/api/tasks/' + taskId,
                type: 'PUT', // Use PUT for updates
                contentType: 'application/json',
                data: JSON.stringify(updatedTask),
                success: function(response) {
                    // On success, hide modal and optionally show success message or refresh page
                    $('#editTaskModal').modal('hide');
                    location.reload(); // Simple way to refresh the task list
                },
                error: function(xhr, status, error) {
                    // Handle errors (e.g., show an alert)
                    alert('Error updating task: ' + xhr.responseText);
                    console.error('Error updating task:', xhr.responseText);
                }
            });
        });
    });
    /*]]>*/
</script>
</body>
</html>-->


<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>My ToDoList</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light navbar-custom">
    <a class="navbar-brand" href="#">
        <i class="fas fa-check-double mr-2"></i>ToDoList
    </a>
    <div class="collapse navbar-collapse justify-content-end">
        <ul class="navbar-nav">
            <li class="nav-item mr-3">
                <span class="navbar-text">Welcome, <strong sec:authentication="name">User</strong>!</span>
            </li>
            <li class="nav-item">
                <form th:action="@{/logout}" method="post" class="form-inline">
                    <button type="submit" class="btn btn-outline-warning">
                        <i class="fas fa-sign-out-alt mr-1"></i>Logout
                    </button>
                </form>
            </li>
        </ul>
    </div>
</nav>

<div class="container container-main">
    <div th:if="${message}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${message}"></span>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <div class="card mb-5">
        <div class="card-header card-header-custom">
            <i class="fas fa-plus-circle mr-2"></i>Add New Task
        </div>
        <div class="card-body">
            <form th:action="@{/tasks}" th:object="${newTask}" method="post" class="form-add-task">
                <div class="form-group">
                    <label for="title" class="sr-only">Task Title</label>
                    <input type="text" id="title" th:field="*{title}" class="form-control form-control-lg"
                           placeholder="What do you need to do?"
                           th:classappend="${#fields.hasErrors('title') ? 'is-invalid' : ''}" required/>
                    <div th:if="${#fields.hasErrors('title')}" th:errors="*{title}" class="invalid-feedback"></div>
                </div>
                <div class="form-group">
                    <label for="description" class="sr-only">Description (Optional)</label>
                    <textarea id="description" th:field="*{description}" class="form-control"
                              rows="2" placeholder="Optional description..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-lg btn-block">
                    <i class="fas fa-paper-plane mr-2"></i>Add Task
                </button>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-header card-header-custom">
            <i class="fas fa-tasks mr-2"></i>Your Tasks
        </div>
        <div class="card-body p-0">
            <ul class="list-group list-group-flush">
                <li th:each="task : ${tasks}"
                    th:classappend="${task.completed ? 'completed-task' : ''}"
                    class="list-group-item task-item" th:data-task-id="${task.id}" th:data-task-title="${task.title}" th:data-task-description="${task.description}" th:data-task-completed="${task.completed}">
                    <div class="task-content">
                        <h5 class="task-title" th:text="${task.title}">Task Title</h5>
                        <p th:if="${task.description}" class="task-description" th:text="${task.description}"></p>
                        <small class="text-muted mt-1" th:text="${#temporals.format(task.createdAt, 'MMM dd, yyyy HH:mm')}"></small>
                    </div>
                    <div class="task-actions">
                        <form th:action="@{/tasks/{id}/toggle(id=${task.id})}" method="post" class="d-inline-block">
                            <button type="submit"
                                    th:classappend="${task.completed ? 'btn-toggle-complete incomplete' : 'btn-toggle-complete'}"
                                    class="btn btn-sm btn-icon">
                                <span th:if="${task.completed}"><i class="fas fa-times mr-1"></i>Mark Incomplete</span>
                                <span th:unless="${task.completed}"><i class="fas fa-check mr-1"></i>Mark Complete</span>
                            </button>
                        </form>
                        <button type="button" class="btn btn-info btn-sm btn-icon edit-task-btn" data-toggle="modal" data-target="#editTaskModal">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <form th:action="@{/tasks/{id}/delete(id=${task.id})}" method="post" class="d-inline-block">
                            <button type="submit" class="btn btn-danger btn-sm btn-icon btn-delete"
                                    onclick="return confirm('Are you sure you want to delete this task?');">
                                <i class="fas fa-trash-alt"></i> Delete
                            </button>
                        </form>
                    </div>
                </li>
                <li th:if="${#lists.isEmpty(tasks)}" class="list-group-item text-muted">
                    No tasks yet! Add one above to get started.
                </li>
            </ul>
        </div>
    </div>

    <div class="card mt-5">
        <div class="card-header card-header-custom">
            <i class="fas fa-robot mr-2"></i>AI Prioritization Suggestion
        </div>
        <div class="card-body text-center">
            <button id="getAiSuggestionBtn" class="btn btn-info btn-lg">
                <i class="fas fa-brain mr-2"></i>Get AI Task Suggestion
            </button>
            <div id="aiSuggestionOutput" class="alert alert-light mt-3" role="alert" style="display: none;">
            </div>
            <div id="aiLoadingSpinner" class="spinner-border text-info mt-3" role="status" style="display: none;">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
    </div>

</div> <div class="modal fade" id="editTaskModal" tabindex="-1" role="dialog" aria-labelledby="editTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editTaskModalLabel"><i class="fas fa-edit mr-2"></i>Edit Task</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="editTaskForm">
                    <input type="hidden" id="editTaskId">
                    <div class="form-group">
                        <label for="editTaskTitle">Title:</label>
                        <input type="text" class="form-control" id="editTaskTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="editTaskDescription">Description:</label>
                        <textarea class="form-control" id="editTaskDescription" rows="3"></textarea>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="editTaskCompleted">
                        <label class="form-check-label" for="editTaskCompleted">Completed</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveTaskChangesBtn"><i class="fas fa-save mr-2"></i>Save changes</button>
            </div>
        </div>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script th:inline="javascript">
    /*<![CDATA[*/

    // AI Suggestion Logic (BUTTON IS PRESENT, BUT THIS SCRIPT IS COMMENTED OUT)
    document.getElementById('getAiSuggestionBtn').addEventListener('click', function() {
         const outputDiv = document.getElementById('aiSuggestionOutput');
         const spinner = document.getElementById('aiLoadingSpinner');
         const button = this;

         outputDiv.style.display = 'none';
         outputDiv.innerHTML = '';
         spinner.style.display = 'block';
         button.disabled = true;

         fetch('/api/tasks/prioritize-suggestion', {
             method: 'GET',
             headers: {
                 'Accept': 'text/plain',
                 'X-Requested-With': 'XMLHttpRequest'
             }
         })
         .then(response => {
             if (!response.ok) {
                 return response.text().then(text => { throw new Error(text) });
             }
            return response.text();
        })
         .then(data => {
            outputDiv.innerHTML = '<pre>' + data + '</pre>';
             outputDiv.classList.remove('alert-danger');
             outputDiv.classList.add('alert-light');
             outputDiv.style.display = 'block';
         })
         .catch(error => {
             console.error('Error fetching AI suggestion:', error);
             outputDiv.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>Failed to get suggestion: ' + error.message;
             outputDiv.classList.remove('alert-light');
           outputDiv.classList.add('alert-danger');
             outputDiv.style.display = 'block';
         })
         .finally(() => {
             spinner.style.display = 'none';
             button.disabled = false;
         });
     });


    $(document).ready(function() {
        // When an "Edit" button is clicked
        $('.edit-task-btn').on('click', function() {
            // Get data attributes from the <li> element (parent of the button)
            const $taskItem = $(this).closest('li');
            const taskId = $taskItem.data('taskId');
            const taskTitle = $taskItem.data('taskTitle');
            const taskDescription = $taskItem.data('taskDescription');
            const taskCompleted = $taskItem.data('taskCompleted'); // Boolean value

            // Populate the modal form fields
            $('#editTaskId').val(taskId);
            $('#editTaskTitle').val(taskTitle);
            $('#editTaskDescription').val(taskDescription);
            $('#editTaskCompleted').prop('checked', taskCompleted); // Set checkbox state
        });

        // When the "Save changes" button in the modal is clicked
        $('#saveTaskChangesBtn').on('click', function() {
            const taskId = $('#editTaskId').val();
            const updatedTask = {
                title: $('#editTaskTitle').val(),
                description: $('#editTaskDescription').val(),
                completed: $('#editTaskCompleted').is(':checked')
            };

            // Send PUT request to the backend
            $.ajax({
                url: '/api/tasks/' + taskId,
                type: 'PUT', // Use PUT for updates
                contentType: 'application/json',
                data: JSON.stringify(updatedTask),
                success: function(response) {
                    // On success, hide modal and optionally show success message or refresh page
                    $('#editTaskModal').modal('hide');
                    location.reload();
                },
                error: function(xhr, status, error) {
                    // Handle errors (e.g., show an alert)
                    alert('Error updating task: ' + xhr.responseText);
                    console.error('Error updating task:', xhr.responseText);
                }
            });
        });
    });

</script>
</body>
</html>